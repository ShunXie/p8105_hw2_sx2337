---
title: "p8105_hw2_sx2337"
author: "Shun Xie"
date: "2022-09-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#load all the data
library(tidyverse)
options(tibble.print_min = 5)
```


# Problem 1
NYC_Transit_Subway_Entrance_And_Exit_Data is the dataset that includes all the NYC transit data. First, clean the data:

```{r}
NYC_transit = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(line, station_name, station_latitude:entry, vending, ada) %>%
  mutate(entry = recode(entry, "YES" = TRUE, "NO" = FALSE))
head(NYC_transit)
```

The original data set contains 33 varibles, namely: Division,	Line,	Station Name,	Station Latitude,	Station Longitude,	Route1,	Route2,	Route3,	Route4,	Route5,	Route6,	Route7,	Route8,	Route9,	Route10,	Route11,	Entrance Type,	Entry,	Exit Only,	Vending,	Staffing,	Staff Hours,	ADA,	ADA Notes,	Free Crossover,	North South Street,	East West Street,	Corner,	Entrance Latitude,	Entrance Longitude,	Station Location and	Entrance Location. Out of these variables, I selected the required variables for line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance.

For data cleaning, I first clean the names of data using janitor package, then select the required variables and change the entry variable from character to logical variables. The resulting data is shown above. The data is not exactly very tidy because there are a total of 11 route variables that could be merge using pivot_longer function. Additionally, the variable names are not all characters. Some of the variables are double. 


Now here is the answer to 3 questions:

1. How many distinct stations are there?
```{r}
distinct_station = distinct(NYC_transit, NYC_transit$line,NYC_transit$station_name,.keep_all=TRUE)
num_distinct_station = nrow(distinct_station)
print(num_distinct_station)
```
First I use distinct function to find distinct pair of station name and line. Note when keep_all=TRUE, all the variables in the dataframe will be kept but with only distinct pair of station name and line. Then I use nrow function to return the total number of row. 
There are a total of 465 distinct stations.

2. How many stations are ADA compliant?
```{r}
num_ADA = filter(distinct_station,ada==TRUE) %>%
  length()
print(num_ADA)
```
First I filter and left all the station that is ada compliant. Then I use length function to return the number of values left. 
There are a total of 21 station that is ada compliant.

3. What proportion of station entrances / exits without vending allow entrance?
```{r}
num_no_vending = filter(NYC_transit, vending=='NO') %>%
  nrow()
num_total = nrow(NYC_transit)
proportion_without_vending = num_no_vending/num_total
print(proportion_without_vending)
```
First I filter all the station entrances/ exits without vending and get the number by using nrow(). Then I get the total number of station entrances/exits. 
The proportion is 0.098 (3d.p.)


Now reform the data first by tidy up the variable name of route into characters.
```{r}
NYC_transit_adpt = mutate(NYC_transit,across(route1:route11, as.character))
```

Then, first get the reform data so that route number and route name are distinct variables. 
```{r}
reform_NYC_transit = 
pivot_longer(NYC_transit_adpt,
    route1:route11,
    names_to = "route_number", 
    values_to = "route_name",
    values_drop_na = TRUE)
reform_NYC_transit
```

To answer the question of How many distinct stations serve the A train, I need to first filter the stations that serve A train and then return all the distinct stations by distinct function. Lastly, get the number by nrow()

```{r}
distinct_station_A = filter(reform_NYC_transit,route_name=='A') %>%
  distinct( line,station_name,.keep_all=TRUE) 

print(nrow(distinct_station_A))
```
There are 60 distinct stations serve the A train. 

```{r}
num_ADA_distinct_station_A = filter(distinct_station_A,ada=='TRUE') %>%
  nrow()
print(num_ADA_distinct_station_A)
```
By filtering all ada compliant from the distinct stations serve the A train and return the number by using nrow, there are 17 station are ADA compliant.



# Problem 2
First, load the data. The first line of the data is a logo, in which need to skip it. Also do not include the last several columns by specifying the columns that need to be included in the range argument in read_excel. Then change the variable name of weight (tons) to weight and Volume (cubic yards) to volume. Also change other variable names into a lower case character that two words are seperated by underline. After that, ommit rows that does not include dumpster-specific data using drop_na function. The last row contains grand total will also be excluded by using filter function filters all rows except for the last row. Lastly, round the number of sports balls to the nearest integer and converts the result to an integer variable.
```{r}
Mr_trash_wheel = 
  readxl::read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",skip = 1,sheet=1,range = cellranger::cell_cols("A:N"))  %>%
  select(Dumpster=Dumpster, weight = `Weight (tons)`,volume = `Volume (cubic yards)`,plastic_bottle = `Plastic Bottles`, cigarette_butts = `Cigarette Butts`,glass_bottles=`Glass Bottles`, grocery_bags=`Grocery Bags`, chip_bags = `Chip Bags`, sports_balls=`Sports Balls`,home_powered = `Homes Powered*`, everything())%>%
  drop_na(Dumpster) %>%
  filter(row_number()!=n())%>%
  mutate(sports_balls = as.integer(sports_balls))
  
head(Mr_trash_wheel)
```


Now do the similar process to Professor Trash Wheel.

```{r}
Prof_trash_wheel = 
  readxl::read_excel("./data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",skip = 1,sheet=2,range = cellranger::cell_cols("A:N"))  %>%
  select(Dumpster=Dumpster, weight = `Weight (tons)`,volume = `Volume (cubic yards)`,plastic_bottle = `Plastic Bottles`, cigarette_butts = `Cigarette Butts`,glass_bottles=`Glass Bottles`, grocery_bags=`Grocery Bags`, chip_bags = `Chip Bags`, sports_balls=`Sports Balls`,home_powered = `Homes Powered*`, everything())%>%
  drop_na(Dumpster) %>%
  filter(row_number()!=n())%>%
  mutate(sports_balls = as.integer(sports_balls))
  
head(Prof_trash_wheel)
```

First, add two columns specifying the dataset is Mr or Prof. Then join two dataframes vertically using rbind:

```{r}
Mr_trash_wheel = mutate(Mr_trash_wheel, Mr_or_prof = 'Mr')
Prof_trash_wheel = mutate(Prof_trash_wheel, Mr_or_prof = 'Prof')
merged_df = rbind(Mr_trash_wheel,Prof_trash_wheel)
```

The data has a total of ```r nrow(merged_df)``` number of time that trash is collected and dumped into a dumpster after combining Mr_trash_wheel and Prof_trash_wheel. The key variables are the weight of dumpster measuring in tons and the average of each dumpster weights ```r mean(merged_df$weight)```. For the data collected by Mr Trash wheel, the average weight is ```r mean(filter(merged_df,Mr_or_prof=='Mr')$weight)``` tons whereas Prof Trash wheel has an average of ```r mean(filter(merged_df,Mr_or_prof=='Prof')$weight)``` tons. Another important factor is the volume of dumpsters, measuring in cubic yards. The average volume of each dumpster is  ```r mean(merged_df$volume)```. For the data collected by Mr Trash wheel, the average volume is ```r mean(filter(merged_df,Mr_or_prof=='Mr')$volume)``` cubic yards whereas Prof Trash wheel has an average of ```r mean(filter(merged_df,Mr_or_prof=='Prof')$volume)``` cubic yards. 

The dataset also measures number of plastic bottles, cigeratte butts, glass bottles, grocery bags, chip bags and sports balls. The average of the above variables is: ```r mean(merged_df$plastic_bottles)```, ```r mean(merged_df$cigeratte_butts)```, ```r mean(merged_df$glass_bottles)```, ```r mean(merged_df$grocery_bags)```, ```r mean(merged_df$chip_bags)```, ```r mean(merged_df$sports_balls)``` respectively. 


The total weight of trash collected by Professor Trash Wheel is ```r sum(filter(merged_df,Mr_or_prof=='Prof')$weight)``` tons. 
The total number of sports balls collected by Mr. Trash Wheel in 2020 is ```r sum(filter(merged_df,Mr_or_prof=='Mr',Year == 2020)$sports_balls)```



# Problem 3

